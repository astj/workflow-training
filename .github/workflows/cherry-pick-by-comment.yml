# マージ済みの p-r に `@astjbot backport` とコメントされたとき、その p-r を prev に cherry-pick する
name: cherry-pick to prev by comment
on:
  issue_comment:
    types : [created]

jobs:
  get-pull-request:
    if: github.event.issue.pull_request &&
        github.event.issue.pull_request.merged_at &&
        contains(github.event.comment.body, '@astjbot backport')
    runs-on: ubuntu-latest
    steps:
      - name: Get pull request details via JSON
        run: |
          echo 'pr_json<<EOF' >> $GITHUB_ENV
          gh api $PR_URL >> $GITHUB_ENV
          echo 'EOF' >> $GITHUB_ENV
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_URL: ${{ github.event.issue.pull_request.url }}
  cherry-pick:
    needs: [get-pull-request]
    uses: ./.github/workflows/cherry-pick-workflow.yml
    with:
      base: prev
      pull_request_json: ${{ env.pr_json }}
